name: Inspection

on:
  pull_request:
  deployment:

jobs:
  inspection:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Set up Ruby
        uses: actions/setup-ruby@v1
        with:
          ruby-version: '2.6'
          architecture: 'x64'
      
      - name: Set up JDK 1.8
        uses: actions/setup-java@v1
        with:
          java-version: 1.8

      - name: Run Ktlint
        run: ./gradlew lintDebug ktlint

      - name: Run danger
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          danger_path="scripts/danger"
          export BUNDLE_PATH="$danger_path/vendor/bundle"
          export BUNDLE_GEMFILE="$danger_path/Gemfile"
          bundle install
          bundle exec danger --dangerfile="$danger_path/Dangerfile"
          
